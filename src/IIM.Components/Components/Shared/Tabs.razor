@using Microsoft.AspNetCore.Components
@namespace IIM.Components.Shared

<!-- Important: render children first inside a CascadingValue so they can Register() -->
<CascadingValue Value="this">
    @ChildContent
</CascadingValue>

<div class="tabs-container">
    <!-- Tab headers -->
    <ul class="nav nav-tabs">
        @foreach (var tab in _tabs)
        {
            var isActive = ActiveTabId == tab.Id;

            <li class="nav-item">
                <button type="button"
                        class="nav-link @(isActive ? "active" : "")"
                        disabled="@tab.Disabled"
                        @onclick="() => Activate(tab.Id)"
                        @onkeydown="(e) => OnKeyDown(e, tab.Id)">
                    @if (!string.IsNullOrEmpty(tab.Icon))
                    {
                        <i class="@tab.Icon me-1"></i>
                    }
                    @tab.Title
                </button>
            </li>
        }
    </ul>

    <!-- Tab content -->
    <div class="tab-content border border-top-0 p-3">
        @foreach (var tab in _tabs)
        {
            var isActive = ActiveTabId == tab.Id;

            if (isActive || (!IsLazy && _everActivated.Contains(tab.Id)))
            {
                <div class="tab-pane fade @(isActive ? "show active" : "")">
                    @tab.ChildContent
                </div>
            }
        }
    </div>
</div>
