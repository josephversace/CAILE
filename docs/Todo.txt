Project Overview
Intelligent Investigation Machine (IIM) - A Blazor Hybrid + WSL2 desktop application for law enforcement AI investigations. Premium training platform delivered as part of the "AI Investigator Mastery Bootcamp" running entirely on-premises on Framework PCs with 128GB RAM and AMD GPUs.
Current Solution Structure
/src
â”œâ”€â”€ IIM.Shared/          # DTOs, Enums, Common Models (no dependencies)
â”‚   â”œâ”€â”€ DTOs/           # API request/response contracts
â”‚   â”œâ”€â”€ Enums/          # Shared enumerations  
â”‚   â””â”€â”€ Models/         # TimeRange, FileMetadata, etc.
â”‚
â”œâ”€â”€ IIM.Infrastructure/  # External services, WSL, Storage
â”‚   â””â”€â”€ Platform/       # âœ… PHASE 1 COMPLETE
â”‚       â”œâ”€â”€ IWslManager.cs (interface)
â”‚       â”œâ”€â”€ WslManager.cs 
â”‚       â”œâ”€â”€ WslManager.Core.cs
â”‚       â”œâ”€â”€ WslManager.Docker.cs
â”‚       â”œâ”€â”€ WslManager.Files.cs
â”‚       â””â”€â”€ WslServiceOrchestrator.cs
â”‚
â”œâ”€â”€ IIM.Plugin.SDK/     # Plugin interfaces for extensibility
â”‚
â”œâ”€â”€ IIM.Core/           # Domain models, business logic
â”‚   â”œâ”€â”€ Models/         # Case, Evidence, Investigation, ModelConfiguration
â”‚   â”œâ”€â”€ Services/       # Core business services, Export services, SessionService
â”‚   â”œâ”€â”€ AI/            
â”‚   â”‚   â”œâ”€â”€ ModelOrchestrator.cs (âœ… Working implementation)
â”‚   â”‚   â”œâ”€â”€ DefaultModelOrchestrator.cs
â”‚   â”‚   â”œâ”€â”€ SemanticKernelOrchestrator.cs (âœ… NEW - SK integration)
â”‚   â”‚   â””â”€â”€ IModelOrchestrator.cs (interface)
â”‚   â”œâ”€â”€ Inference/     
â”‚   â”‚   â””â”€â”€ InferencePipeline.cs (âš ï¸ Needs queue processing completion)
â”‚   â”œâ”€â”€ RAG/           # âš ï¸ Empty implementations
â”‚   â”œâ”€â”€ Mediator/      # âœ… Custom mediator (complete, working)
â”‚   â”œâ”€â”€ Configuration/ # âœ… Template system (complete)
â”‚   â”‚   â””â”€â”€ IModelConfigurationTemplate.cs
â”‚   â”œâ”€â”€ Extensions/    # âœ… NEW - SK service registration
â”‚   â”‚   â””â”€â”€ SemanticKernelServiceExtensions.cs
â”‚   â””â”€â”€ Plugins/       # âœ… NEW - SK Plugins
â”‚       â””â”€â”€ ForensicAnalysisPlugin.cs
â”‚
â”œâ”€â”€ IIM.Application/    # Application services, CQRS
â”‚   â”œâ”€â”€ Commands/      # âœ… CQRS commands with handlers
â”‚   â”‚   â”œâ”€â”€ Wsl/       # Including ConfigureProxyCommand
â”‚   â”‚   â”œâ”€â”€ Models/    # Load/Unload model commands
â”‚   â”‚   â””â”€â”€ Investigation/
â”‚   â”œâ”€â”€ Queries/       # âœ… Query handlers
â”‚   â”œâ”€â”€ Behaviors/     # âœ… 7 Pipeline behaviors (all working)
â”‚   â””â”€â”€ Services/      
â”‚       â”œâ”€â”€ InferenceService.cs (Functional with basic implementation)
â”‚       â””â”€â”€ InvestigationService.cs (Working)
â”‚
â”œâ”€â”€ IIM.Api/           # HTTP endpoints, Minimal APIs
â”‚   â””â”€â”€ Program.cs     # All endpoints defined here
â”‚
â”œâ”€â”€ IIM.Components/    # Blazor UI components
â”‚   â””â”€â”€ Components/    # UI components for investigations
â”‚
â””â”€â”€ IIM.Desktop/       # Windows Forms host
    â””â”€â”€ Program.cs     # âœ… Updated with SK support (builds successfully)

/tests
â”œâ”€â”€ IIM.Core.Tests/
â”‚   â”œâ”€â”€ Infrastructure/
â”‚   â”‚   â””â”€â”€ WslManagerTests.cs
â”‚   â””â”€â”€ Mocks/
â”‚       â”œâ”€â”€ MockWslManager.cs (âœ… Complete implementation)
â”‚       â””â”€â”€ MockModelOrchestrator.cs
â””â”€â”€ IIM.Integration.Tests/
âœ… COMPLETED WORK
Phase 1: WSL & Docker Foundation (COMPLETE)

WslManager: Full WSL2 management with Docker orchestration
Service Orchestration: Qdrant (6333), PostgreSQL (5432), MinIO (9000/9001)
Non-admin support: PowerShell script generation for IT departments
Tor proxy support: InstallTorAndApplyProxyAsync implementation

Mediator Pattern (COMPLETE)

Custom Mediator: Fully implemented without MediatR dependency
7 Pipeline Behaviors: Logging, Validation, Performance, Caching, Retry, Transaction, Audit
Notification System: Complete with handlers for WSL, Model, and Investigation events
Command/Query Handlers: Full CQRS implementation

Template System (COMPLETE)

ModelConfigurationTemplate: Full template management for investigation types
Template Service: Save/load/apply templates to sessions
System Templates: Pre-configured templates for different investigation scenarios

Semantic Kernel Integration (NEW - COMPLETE)

SemanticKernelOrchestrator: Implements IModelOrchestrator interface
SK Service Extensions: Clean DI registration
ForensicAnalysisPlugin: First SK plugin with investigation functions
Backward Compatible: Works alongside existing ModelOrchestrator

ğŸš§ CURRENT STATUS
What's Working:

Build Status: âœ… Solution builds successfully
WSL Management: âœ… Fully functional
Mediator Pattern: âœ… All commands/queries working
Template System: âœ… Models loaded from templates
Basic Inference: âœ… Mock inference working
SK Integration: âœ… Compiles and ready for testing

What Needs Work:

DirectML/ONNX: Package installed but no actual GPU inference
InferencePipeline: Queue processing incomplete
RAG Implementation: Empty, needs document ingestion
Real Model Loading: Currently using mocks

ğŸ“‹ NEXT STEPS (Priority Order)
Sprint 1: Test SK Integration (This Week)
csharp// 1. Test SK orchestrator with mock models
var orchestrator = ServiceProvider.GetRequiredService<IModelOrchestrator>();
var models = await orchestrator.GetAvailableModelsAsync();
await orchestrator.LoadModelAsync(new ModelRequest { ... });

// 2. Test ForensicAnalysisPlugin
var plugin = ServiceProvider.GetRequiredService<ForensicAnalysisPlugin>();
var hash = await plugin.CalculateHashAsync("evidence.pdf");

// 3. Verify template integration
var templates = await templateService.GetTemplatesAsync();
Sprint 2: Complete DirectML/ONNX (Week 2)
csharp// 1. Implement DirectMLTextGenerationService properly
public class DirectMLTextGenerationService : ITextGenerationService
{
    private readonly InferenceSession _session;
    
    public DirectMLTextGenerationService(string modelPath)
    {
        var sessionOptions = new SessionOptions();
        sessionOptions.AppendExecutionProvider_DML(0);
        _session = new InferenceSession(modelPath, sessionOptions);
    }
    
    // Actual tensor operations here
}

// 2. Test with real ONNX models
// 3. Benchmark GPU vs CPU performance
Sprint 3: Complete InferencePipeline (Week 3)

Fix queue processing loop
Implement priority-based scheduling
Add batch processing
Handle cancellation properly

Sprint 4: RAG Implementation (Week 4)

Document chunking strategies
Embedding generation with ONNX
Qdrant integration
Citation extraction

ğŸ¯ Configuration for Testing
appsettings.json
json{
  "Storage": {
    "LocalBasePath": "C:\\\\Users\\\\[username]\\\\AppData\\\\Local\\\\IIM"
  },
  "Models": {
    "BasePath": "C:\\\\Users\\\\[username]\\\\AppData\\\\Local\\\\IIM\\\\Models"
  },
  "Api": {
    "BaseUrl": "http://localhost:5080"
  },
  "Evidence": {
    "EnableEncryption": false,
    "RequireDualControl": false,
    "MaxFileSizeMb": 10240
  }
}
To Switch Between Orchestrators:
Option 1: Keep Existing (Safe)
csharp// In Program.cs
services.AddSingleton<IModelOrchestrator, ModelOrchestrator>();
Option 2: Use Semantic Kernel (New)
csharp// In Program.cs
services.AddSemanticKernelOrchestration();
services.AddInvestigationPlugins();
ğŸ”§ Technical Decisions

Semantic Kernel over Custom: Better plugin ecosystem, Microsoft support
DirectML over ROCm: ROCm unstable on Windows, DirectML is native
ONNX Format: Best DirectML compatibility
Custom Mediator: Full control, no external dependencies
Templates First: Models discovered from templates, not hardcoded

ğŸ“Š Success Metrics
Current phase complete when:

âœ… SK successfully loads a model
âœ… Inference pipeline processes a request
âœ… ForensicAnalysisPlugin executes a function
â¬œ DirectML runs inference on GPU
â¬œ RAG returns results with citations
â¬œ Memory usage under 64GB for typical workload

ğŸ’¡ Development Commands
bash# Build
dotnet build

# Run Desktop App
dotnet run --project src/IIM.Desktop

# Run API
dotnet run --project src/IIM.Api

# Run Tests
dotnet test

# Check WSL Status
wsl --list --verbose

# Start Docker in WSL
wsl -d IIM-Ubuntu -- docker ps
ğŸ› Known Issues



ğŸ“ Notes for Developers

Current State: WSL works, SK integrated, ready for AI implementation
Next Priority: Test SK with real models
Blockers: Need actual ONNX model files

Testing: Use MockWslManager for unit tests

Remember: This is for law enforcement training - reliability and ease of use are paramount. The system must "just work" out of the box for non-technical users.